<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.proxy.ustclug.org/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Bianle's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Bianle's Blog">
<meta property="og:url" content="http://2le.me/page/27/index.html">
<meta property="og:site_name" content="Bianle's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bianle's Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="http://2le.me/page/27/"/>





  <title>Bianle's Blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <!-- hexo-inject:begin --><!-- hexo-inject:end --><script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3519f77bf8b5b1d5a98cc671b3a83214";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bianle's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">The quieter you become, the more you are able to hear.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/07/04/linux-nano-vim-vi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/07/04/linux-nano-vim-vi/" itemprop="url">文本编辑器：nano vim/vi</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>1.Nano是一个简单的没有花梢及华丽效果的文本编辑器。Nano在做简单文本文件编辑时相当不错,可以满足一些基本操作.
直接在命令行模式下输入nano 文件名，就可以对文件进行简单的编辑。
文件编辑中常用快捷键：ctrl+X 离开nano软件，若有修改过的文件会提示是否保存；
ctrl+O 保存文件； Ctrl+W 查询字符串；
ctrl +C 说明目前光标所在处的行数和列数等信息；
ctrl+ _ 可以直接输入行号，让光标快速移到该行；
<a href="http://2.vi" target="_blank" rel="external">2.vi</a> ：vi编辑器是所有Unix及Linux系统下标准的编辑器 ，功能强大，vim可视作vi的高级版本。
1） vi可以分为三种模式：命令行模式，输入模式，末行模式。
命令行模式—&gt;输入模式： i，a，A,o，O，c，C，r，R均可从命令行切换到输入行；
i:在当前光标所在处插入； a：当前光标所在行的后面插入； A：当前光标所在行行尾插入；
o:在当前光标所在处的下一行插入新的一行； O:在当前光标所在处的上一行插入新的一行；
c:先删除在载入新的一行； C:删除光标所在一行在插入；
r:替换光标所在那一个字符一次； R:一直替换光标所在处的文字；
输入模式—&gt;命令行模式：Esc
命令行模式—&gt;末行模式：：
末行模式-—&gt;命令行模式：Esc
2） 光标移动： h(&lt;—) 左移光标一个字符 ；
l（—&gt;） 右移光标一个字符 ；
k(↑) 光标上移一行 ;
j (↓) 光标下移一行
「ctrl」+「b」：屏幕往”后”移动一页。
「ctrl」+「f」：屏幕往”前”移动一页。
「ctrl」+「u」：屏幕往”后”移动半页。
「ctrl」+「d」：屏幕往”前”移动半页
3)行内移动：^ 移动到非空白行的行首
0 绝对位置的行首
$移动到行尾
4）以单词为单位移动：
w：一次移动一个单词，到下一个单词的词尾
b：移到当前单词词首（向回跳）
e：跳到词尾
5）行间移动：
n(数字）G ：n数值为几，就移到这个文件的第几行；当n=1时，相当于gg的功能，移到该文件的第一行；
G：移到这个文件的最后一行；
6）删除命令：
x：向后删除一个字符，使用del键同样功能；
X:向后删除一个字符；
nx：连续向后删除n个字符；
dd：删除光标所在的那一整行；
ndd：删除光标所在的向下n行；
d1G：删除光标所在到第一行的所有数据；
dG：删除从光标所在到最后易方达额所有数据；
7）复制，粘贴
yy：复制光标所在的那一整行；
nyy：复制光标所在的向下n行；
y0：复制光标所在的那一个字符到该行行首的所有数据；
y$:复制光标所在的那一个字符到该行行尾的所有数据；
p：将已经复制的数据在光标的下一行粘贴；
P：粘在光标的上一行；
8）查找，替换
/word:向下查找一个名称为word的字符串；
？word：向上查找一个名称为word的字符串；
：n1，n2 s/word1/word2/g ：在n1与n2行之间寻找一个word1的字符串，并将其替换为word2
：1，$ s/word1/word2/g:从第一行到最后一行查找word1字符串，并将其替换为word2
9）文件的保存与退出：
w：在冒号输入字母「w」就可以将文件保存起来；
q：退出；
q!:强制退出；
wq ：保存退出；
wq！：强制保存退出
10）显示行号：在末行模式输入：set nu
取消行号：在末行模式输入：set nonu</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/07/02/it-beauty-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/07/02/it-beauty-code/" itemprop="url">一段惊艳的代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><figure class="highlight scilab"><table><tr><td class="code"><pre><div class="line">with(m=Math)C=<span class="built_in">cos</span>,S=<span class="built_in">sin</span>,P=pow,R=random;c.width=c.height=f=<span class="number">500</span>;h=<span class="number">-250</span>;<span class="function"><span class="keyword">function</span> <span class="title">p</span><span class="params">(a,b,c)</span>&#123;<span class="title">if</span><span class="params">(c&gt;60)</span><span class="title">return</span>[<span class="title">S</span><span class="params">(a*7)</span>*<span class="params">(13+5/(.2+P(b*4,4)</span>))-<span class="title">S</span><span class="params">(b)</span>*50,<span class="title">b</span>*<span class="title">f</span>+50,625+<span class="title">C</span><span class="params">(a*7)</span>*<span class="params">(13+5/(.2+P(b*4,4)</span>))+<span class="title">b</span>*400,<span class="title">a</span>*1-<span class="title">b</span>/2,<span class="title">a</span>];<span class="title">A</span>=<span class="title">a</span>*2-1;<span class="title">B</span>=<span class="title">b</span>*2-1;<span class="title">if</span><span class="params">(A*A+B*B&lt;1)</span>&#123;<span class="title">if</span><span class="params">(c&gt;37)</span>&#123;<span class="title">n</span>=<span class="params">(j=c&amp;1)</span>?6:4;<span class="title">o</span>=.5/<span class="params">(a+.01)</span>+<span class="title">C</span><span class="params">(b*125)</span>*3-<span class="title">a</span>*300;<span class="title">w</span>=<span class="title">b</span>*<span class="title">h</span>;<span class="title">return</span>[<span class="title">o</span>*<span class="title">C</span><span class="params">(n)</span>+<span class="title">w</span>*<span class="title">S</span><span class="params">(n)</span>+<span class="title">j</span>*610-390,<span class="title">o</span>*<span class="title">S</span><span class="params">(n)</span>-<span class="title">w</span>*<span class="title">C</span><span class="params">(n)</span>+550-<span class="title">j</span>*350,1180+<span class="title">C</span><span class="params">(B+A)</span>*99-<span class="title">j</span>*300,.4-<span class="title">a</span>*.1+<span class="title">P</span><span class="params">(1-B*B,-h*6)</span>*.15-<span class="title">a</span>*<span class="title">b</span>*.4+<span class="title">C</span><span class="params">(a+b)</span>/5+<span class="title">P</span><span class="params">(C((o*(a+1)</span>+<span class="params">(B&gt;0?w:-w)</span>)/25),30)*.1*<span class="params">(1-B*B)</span>,<span class="title">o</span>/1<span class="title">e3</span>+.7-<span class="title">o</span>*<span class="title">w</span>*3<span class="title">e</span>-6]&#125;<span class="title">if</span><span class="params">(c&gt;32)</span>&#123;<span class="title">c</span>=<span class="title">c</span>*1.16-.15;<span class="title">o</span>=<span class="title">a</span>*45-20;<span class="title">w</span>=<span class="title">b</span>*<span class="title">b</span>*<span class="title">h</span>;<span class="title">z</span>=<span class="title">o</span>*<span class="title">S</span><span class="params">(c)</span>+<span class="title">w</span>*<span class="title">C</span><span class="params">(c)</span>+620;<span class="title">return</span>[<span class="title">o</span>*<span class="title">C</span><span class="params">(c)</span>-<span class="title">w</span>*<span class="title">S</span><span class="params">(c)</span>,28+<span class="title">C</span><span class="params">(B*.5)</span>*99-<span class="title">b</span>*<span class="title">b</span>*<span class="title">b</span>*60-<span class="title">z</span>/2-<span class="title">h</span>,<span class="title">z</span>,<span class="params">(b*b*.3+P((1-(A*A)</span>),7)*.15+.3)*<span class="title">b</span>,<span class="title">b</span>*.7]&#125;<span class="title">o</span>=<span class="title">A</span>*<span class="params">(2-b)</span>*<span class="params">(80-c*2)</span>;<span class="title">w</span>=99-<span class="title">C</span><span class="params">(A)</span>*120-<span class="title">C</span><span class="params">(b)</span>*<span class="params">(-h-c*4.9)</span>+<span class="title">C</span><span class="params">(P(1-b,7)</span>)*50+<span class="title">c</span>*2;<span class="title">z</span>=<span class="title">o</span>*<span class="title">S</span><span class="params">(c)</span>+<span class="title">w</span>*<span class="title">C</span><span class="params">(c)</span>+700;<span class="title">return</span>[<span class="title">o</span>*<span class="title">C</span><span class="params">(c)</span>-<span class="title">w</span>*<span class="title">S</span><span class="params">(c)</span>,<span class="title">B</span>*99-<span class="title">C</span><span class="params">(P(b, 7)</span>)*50-<span class="title">c</span>/3-<span class="title">z</span>/1.35+450,<span class="title">z</span>,<span class="params">(1-b/1.2)</span>*.9+<span class="title">a</span>*.1, <span class="title">P</span><span class="params">((1-b)</span>,20)/4+.05]&#125;&#125;<span class="title">setInterval</span><span class="params">('for(i=0;i&lt;1e4;i++)</span><span class="title">if</span><span class="params">(s=p(R()</span>,<span class="title">R</span><span class="params">()</span>,<span class="title">i</span>%46/.74))&#123;<span class="title">z</span>=<span class="title">s</span>[2];<span class="title">x</span>=~~<span class="params">(s[0]*f/z-h)</span>;<span class="title">y</span>=~~<span class="params">(s[1]*f/z-h)</span>;<span class="title">if</span><span class="params">(!m[q=y*f+x]|m[q]&gt;z)</span><span class="title">m</span>[<span class="title">q</span>]=<span class="title">z</span>,<span class="title">a</span>.<span class="title">fillStyle</span>="<span class="title">rgb</span><span class="params">("+~(s[3]*h)</span>+","+~<span class="params">(s[4]*h)</span>+","+~<span class="params">(s[3]*s[3]*-80)</span>+")",<span class="title">a</span>.<span class="title">fillRect</span><span class="params">(x,y,1,1)</span>&#125;',0)</span></div></pre></td></tr></table></figure>
<p>上面这段JavaScript代码一共有1018个字符，每个字符占一个字节，一共1018B，约等于1K。这1K大小的js能做什么，点一下这面这个按钮就知道了（需要使用最新版的谷歌浏览器、IE9或火狐浏览器等支持html5的浏览器才能看到效果）。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/30/php-zip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/30/php-zip/" itemprop="url">php在线解压工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>部分空间不支持在线解压，造成ftp上传文件量大的文件夹很慢，于是网上找到了一个不错的php在线解压工具，本地xampp环境下测试通过，收藏备用。所有代码均为转载，版权归原作者。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"></div><div class="line"><span class="comment">//设定密码</span></div><div class="line">$password = <span class="string">"bianle"</span>;</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">profile</span>=<span class="string">"http://gmpg.org/xfn/11"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Language"</span> <span class="attr">content</span>=<span class="string">"zh-CN"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>在线解压ZIP - PhpUnZip<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">    &lt;!<span class="selector-tag">--</span></div><div class="line">    <span class="selector-tag">body</span> &#123;</div><div class="line">		<span class="attribute">margin</span>:<span class="number">0</span>;</div><div class="line">		<span class="attribute">padding</span>:<span class="number">0</span>;</div><div class="line">		<span class="attribute">background</span>:<span class="number">#ccc</span>;</div><div class="line">		<span class="attribute">font</span>:<span class="number">14px</span>/<span class="number">24px</span> <span class="string">"Microsoft Yahei"</span>,Verdana, Geneva, sans-serif</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#wrapper</span> &#123;</div><div class="line">		<span class="attribute">width</span>:<span class="number">760px</span>;</div><div class="line">		<span class="attribute">margin</span>:<span class="number">0</span> auto;</div><div class="line">		<span class="attribute">margin-top</span>:<span class="number">10px</span>;</div><div class="line">		<span class="attribute">background</span>:<span class="number">#fff</span>;</div><div class="line">		<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#888</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#header</span> &#123;</div><div class="line">		<span class="attribute">background</span>:<span class="number">#f7f7f7</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#header</span> <span class="selector-tag">h1</span> &#123;</div><div class="line">		<span class="attribute">font</span>:<span class="number">20px</span>/<span class="number">30px</span> Verdana, Geneva, sans-serif;</div><div class="line">		<span class="attribute">font-weight</span>:bold;</div><div class="line">		<span class="attribute">text-shadow</span>:<span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#DDD</span>;</div><div class="line">		<span class="attribute">text-align</span>:center;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#main</span> &#123;</div><div class="line">		<span class="attribute">margin</span>:<span class="number">20px</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#footer</span> &#123;</div><div class="line">		<span class="attribute">text-align</span>:center;</div><div class="line">		<span class="attribute">font-size</span>:<span class="number">12px</span>;</div><div class="line">		<span class="attribute">color</span>:<span class="number">#666</span>;</div><div class="line">		<span class="attribute">border-top</span>:<span class="number">1px</span> solid <span class="number">#ccc</span>;</div><div class="line">		<span class="attribute">position</span>:relative;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#footer</span> <span class="selector-tag">a</span> &#123;</div><div class="line">		<span class="attribute">text-decoration</span>:none;</div><div class="line">		<span class="attribute">color</span>:<span class="number">#666</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#footer</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</div><div class="line">		<span class="attribute">text-decoration</span>:underline;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-id">#eincy</span> &#123;</div><div class="line">		<span class="attribute">width</span>:<span class="number">82px</span>;</div><div class="line">		<span class="attribute">height</span>:<span class="number">36px</span>;</div><div class="line">		<span class="attribute">background</span>:<span class="built_in">url</span>(http://www.eincy.com/logo/s.png);</div><div class="line">		<span class="attribute">position</span>:absolute;</div><div class="line">		<span class="attribute">right</span>:<span class="number">3px</span>;</div><div class="line">		<span class="attribute">top</span>:<span class="number">3px</span>;</div><div class="line">	&#125;</div><div class="line">    <span class="selector-tag">--</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"header"</span>&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>PHP在线解压ZIP工具 - PHPUnZip<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"myform"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"&lt;?=$_SERVER[PHP_SELF];?&gt;"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">onSubmit</span>=<span class="string">"return check_uploadObject(this);"</span>&gt;</span></div><div class="line">            <span class="php"><span class="meta">&lt;?</span></span></div><div class="line">                <span class="keyword">if</span>(!$_REQUEST[<span class="string">"myaction"</span>]):</div><div class="line">            <span class="meta">?&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span><span class="actionscript"></span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">check_uploadObject</span><span class="params">(form)</span></span>&#123;</div><div class="line">                <span class="keyword">if</span>(form.password.value==<span class="string">''</span>)&#123;</div><div class="line">                    alert(<span class="string">'请输入密码.'</span>);</div><div class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"choose"</span>&gt;</span> </div><div class="line">            选择ZIP文件:</div><div class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"zipfile"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">selected</span>&gt;</span>- 请选择 -<span class="tag">&lt;/<span class="name">option</span>&gt;</span></div><div class="line">            <span class="php"><span class="meta">&lt;?</span></span></div><div class="line">                $fdir = opendir(<span class="string">'./'</span>);</div><div class="line">                <span class="keyword">while</span>($file=readdir($fdir))&#123;</div><div class="line">                    <span class="keyword">if</span>(!is_file($file)) <span class="keyword">continue</span>;</div><div class="line">                    <span class="keyword">if</span>(preg_match(<span class="string">'/\.zip$/mis'</span>,$file))&#123;</div><div class="line">                        <span class="keyword">echo</span> <span class="string">"&lt;option value='$file'&gt;$file&lt;/option&gt;\r\n"</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            <span class="meta">?&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">            或上传文件: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"upfile"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"upfile"</span> <span class="attr">size</span>=<span class="string">"20"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"dir"</span>&gt;</span></div><div class="line">            解压到目录: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"todir"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"todir"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">size</span>=<span class="string">"15"</span>&gt;</span> </div><div class="line">                  (留空为本目录,必须有写入权限)</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"password"</span>&gt;</span></div><div class="line">        	验证密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">size</span>=<span class="string">"15"</span>&gt;</span> </div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"unzip"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"myaction"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"myaction"</span> <span class="attr">value</span>=<span class="string">"dounzip"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"Submit"</span> <span class="attr">value</span>=<span class="string">" 解 压 "</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="php"><span class="meta">&lt;?</span></span></div><div class="line"></div><div class="line">		<span class="keyword">elseif</span>($_REQUEST[<span class="string">"myaction"</span>]==<span class="string">"dounzip"</span>):</div><div class="line"></div><div class="line">		<span class="class"><span class="keyword">class</span> <span class="title">zip</span></span></div><div class="line">		&#123;</div><div class="line"></div><div class="line">		 <span class="keyword">var</span> $total_files = <span class="number">0</span>;</div><div class="line">		 <span class="keyword">var</span> $total_folders = <span class="number">0</span>; </div><div class="line"></div><div class="line">		 <span class="function"><span class="keyword">function</span> <span class="title">Extract</span> <span class="params">( $zn, $to, $index = Array<span class="params">(<span class="number">-1</span>)</span> )</span></span></div><div class="line">		 &#123;</div><div class="line">		   $ok = <span class="number">0</span>; $zip = @fopen($zn,<span class="string">'rb'</span>);</div><div class="line">		   <span class="keyword">if</span>(!$zip) <span class="keyword">return</span>(<span class="number">-1</span>);</div><div class="line">		   $cdir = <span class="keyword">$this</span>-&gt;ReadCentralDir($zip,$zn);</div><div class="line">		   $pos_entry = $cdir[<span class="string">'offset'</span>];</div><div class="line"></div><div class="line">		   <span class="keyword">if</span>(!is_array($index))&#123; $index = <span class="keyword">array</span>($index);  &#125;</div><div class="line">		   <span class="keyword">for</span>($i=<span class="number">0</span>; $index[$i];$i++)&#123;</div><div class="line">				<span class="keyword">if</span>(intval($index[$i])!=$index[$i]||$index[$i]&gt;$cdir[<span class="string">'entries'</span>])</div><div class="line">				<span class="keyword">return</span>(<span class="number">-1</span>);</div><div class="line">		   &#125;</div><div class="line">		   <span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;$cdir[<span class="string">'entries'</span>]; $i++)</div><div class="line">		   &#123;</div><div class="line">			 @fseek($zip, $pos_entry);</div><div class="line">			 $header = <span class="keyword">$this</span>-&gt;ReadCentralFileHeaders($zip);</div><div class="line">			 $header[<span class="string">'index'</span>] = $i; $pos_entry = ftell($zip);</div><div class="line">			 @rewind($zip); fseek($zip, $header[<span class="string">'offset'</span>]);</div><div class="line">			 <span class="keyword">if</span>(in_array(<span class="string">"-1"</span>,$index)||in_array($i,$index))</div><div class="line">				$stat[$header[<span class="string">'filename'</span>]]=<span class="keyword">$this</span>-&gt;ExtractFile($header, $to, $zip);</div><div class="line">		   &#125;</div><div class="line">		   fclose($zip);</div><div class="line">		   <span class="keyword">return</span> $stat;</div><div class="line">		 &#125;</div><div class="line"></div><div class="line">		  <span class="function"><span class="keyword">function</span> <span class="title">ReadFileHeader</span><span class="params">($zip)</span></span></div><div class="line">		  &#123;</div><div class="line">			$binary_data = fread($zip, <span class="number">30</span>);</div><div class="line">			$data = unpack(<span class="string">'vchk/vid/vversion/vflag/vcompression/vmtime/vmdate/Vcrc/Vcompressed_size/Vsize/vfilename_len/vextra_len'</span>, $binary_data);</div><div class="line"></div><div class="line">			$header[<span class="string">'filename'</span>] = fread($zip, $data[<span class="string">'filename_len'</span>]);</div><div class="line">			<span class="keyword">if</span> ($data[<span class="string">'extra_len'</span>] != <span class="number">0</span>) &#123;</div><div class="line">			  $header[<span class="string">'extra'</span>] = fread($zip, $data[<span class="string">'extra_len'</span>]);</div><div class="line">			&#125; <span class="keyword">else</span> &#123; $header[<span class="string">'extra'</span>] = <span class="string">''</span>; &#125;</div><div class="line"></div><div class="line">			$header[<span class="string">'compression'</span>] = $data[<span class="string">'compression'</span>];$header[<span class="string">'size'</span>] = $data[<span class="string">'size'</span>];</div><div class="line">			$header[<span class="string">'compressed_size'</span>] = $data[<span class="string">'compressed_size'</span>];</div><div class="line">			$header[<span class="string">'crc'</span>] = $data[<span class="string">'crc'</span>]; $header[<span class="string">'flag'</span>] = $data[<span class="string">'flag'</span>];</div><div class="line">			$header[<span class="string">'mdate'</span>] = $data[<span class="string">'mdate'</span>];$header[<span class="string">'mtime'</span>] = $data[<span class="string">'mtime'</span>];</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($header[<span class="string">'mdate'</span>] &amp;&amp; $header[<span class="string">'mtime'</span>])&#123;</div><div class="line">			 $hour=($header[<span class="string">'mtime'</span>]&amp;<span class="number">0xF800</span>)&gt;&gt;<span class="number">11</span>;$minute=($header[<span class="string">'mtime'</span>]&amp;<span class="number">0x07E0</span>)&gt;&gt;<span class="number">5</span>;</div><div class="line">			 $seconde=($header[<span class="string">'mtime'</span>]&amp;<span class="number">0x001F</span>)*<span class="number">2</span>;$year=(($header[<span class="string">'mdate'</span>]&amp;<span class="number">0xFE00</span>)&gt;&gt;<span class="number">9</span>)+<span class="number">1980</span>;</div><div class="line">			 $month=($header[<span class="string">'mdate'</span>]&amp;<span class="number">0x01E0</span>)&gt;&gt;<span class="number">5</span>;$day=$header[<span class="string">'mdate'</span>]&amp;<span class="number">0x001F</span>;</div><div class="line">			 $header[<span class="string">'mtime'</span>] = mktime($hour, $minute, $seconde, $month, $day, $year);</div><div class="line">			&#125;<span class="keyword">else</span>&#123;$header[<span class="string">'mtime'</span>] = time();&#125;</div><div class="line"></div><div class="line">			$header[<span class="string">'stored_filename'</span>] = $header[<span class="string">'filename'</span>];</div><div class="line">			$header[<span class="string">'status'</span>] = <span class="string">"ok"</span>;</div><div class="line">			<span class="keyword">return</span> $header;</div><div class="line">		  &#125;</div><div class="line"></div><div class="line">		 <span class="function"><span class="keyword">function</span> <span class="title">ReadCentralFileHeaders</span><span class="params">($zip)</span></span>&#123;</div><div class="line">			$binary_data = fread($zip, <span class="number">46</span>);</div><div class="line">			$header = unpack(<span class="string">'vchkid/vid/vversion/vversion_extracted/vflag/vcompression/vmtime/vmdate/Vcrc/Vcompressed_size/Vsize/vfilename_len/vextra_len/vcomment_len/vdisk/vinternal/Vexternal/Voffset'</span>, $binary_data);</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($header[<span class="string">'filename_len'</span>] != <span class="number">0</span>)</div><div class="line">			  $header[<span class="string">'filename'</span>] = fread($zip,$header[<span class="string">'filename_len'</span>]);</div><div class="line">			<span class="keyword">else</span> $header[<span class="string">'filename'</span>] = <span class="string">''</span>;</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($header[<span class="string">'extra_len'</span>] != <span class="number">0</span>)</div><div class="line">			  $header[<span class="string">'extra'</span>] = fread($zip, $header[<span class="string">'extra_len'</span>]);</div><div class="line">			<span class="keyword">else</span> $header[<span class="string">'extra'</span>] = <span class="string">''</span>;</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($header[<span class="string">'comment_len'</span>] != <span class="number">0</span>)</div><div class="line">			  $header[<span class="string">'comment'</span>] = fread($zip, $header[<span class="string">'comment_len'</span>]);</div><div class="line">			<span class="keyword">else</span> $header[<span class="string">'comment'</span>] = <span class="string">''</span>;</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($header[<span class="string">'mdate'</span>] &amp;&amp; $header[<span class="string">'mtime'</span>])</div><div class="line">			&#123;</div><div class="line">			  $hour = ($header[<span class="string">'mtime'</span>] &amp; <span class="number">0xF800</span>) &gt;&gt; <span class="number">11</span>;</div><div class="line">			  $minute = ($header[<span class="string">'mtime'</span>] &amp; <span class="number">0x07E0</span>) &gt;&gt; <span class="number">5</span>;</div><div class="line">			  $seconde = ($header[<span class="string">'mtime'</span>] &amp; <span class="number">0x001F</span>)*<span class="number">2</span>;</div><div class="line">			  $year = (($header[<span class="string">'mdate'</span>] &amp; <span class="number">0xFE00</span>) &gt;&gt; <span class="number">9</span>) + <span class="number">1980</span>;</div><div class="line">			  $month = ($header[<span class="string">'mdate'</span>] &amp; <span class="number">0x01E0</span>) &gt;&gt; <span class="number">5</span>;</div><div class="line">			  $day = $header[<span class="string">'mdate'</span>] &amp; <span class="number">0x001F</span>;</div><div class="line">			  $header[<span class="string">'mtime'</span>] = mktime($hour, $minute, $seconde, $month, $day, $year);</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">			  $header[<span class="string">'mtime'</span>] = time();</div><div class="line">			&#125;</div><div class="line">			$header[<span class="string">'stored_filename'</span>] = $header[<span class="string">'filename'</span>];</div><div class="line">			$header[<span class="string">'status'</span>] = <span class="string">'ok'</span>;</div><div class="line">			<span class="keyword">if</span> (substr($header[<span class="string">'filename'</span>], <span class="number">-1</span>) == <span class="string">'/'</span>)</div><div class="line">			  $header[<span class="string">'external'</span>] = <span class="number">0x41FF0010</span>;</div><div class="line">			<span class="keyword">return</span> $header;</div><div class="line">		 &#125;</div><div class="line"></div><div class="line">		 <span class="function"><span class="keyword">function</span> <span class="title">ReadCentralDir</span><span class="params">($zip,$zip_name)</span></span>&#123;</div><div class="line">			$size = filesize($zip_name);</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($size &lt; <span class="number">277</span>) $maximum_size = $size;</div><div class="line">			<span class="keyword">else</span> $maximum_size=<span class="number">277</span>;</div><div class="line"></div><div class="line">			@fseek($zip, $size-$maximum_size);</div><div class="line">			$pos = ftell($zip); $bytes = <span class="number">0x00000000</span>;</div><div class="line"></div><div class="line">			<span class="keyword">while</span> ($pos &lt; $size)&#123;</div><div class="line">				$byte = @fread($zip, <span class="number">1</span>); $bytes=($bytes &lt;&lt; <span class="number">8</span>) | ord($byte);</div><div class="line">				<span class="keyword">if</span> ($bytes == <span class="number">0x504b0506</span> <span class="keyword">or</span> $bytes == <span class="number">0x2e706870504b0506</span>)&#123; $pos++;<span class="keyword">break</span>;&#125; $pos++;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			$fdata=fread($zip,<span class="number">18</span>);</div><div class="line"></div><div class="line">			$data=@unpack(<span class="string">'vdisk/vdisk_start/vdisk_entries/ventries/Vsize/Voffset/vcomment_size'</span>,$fdata);</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($data[<span class="string">'comment_size'</span>] != <span class="number">0</span>) $centd[<span class="string">'comment'</span>] = fread($zip, $data[<span class="string">'comment_size'</span>]);</div><div class="line">			<span class="keyword">else</span> $centd[<span class="string">'comment'</span>] = <span class="string">''</span>; $centd[<span class="string">'entries'</span>] = $data[<span class="string">'entries'</span>];</div><div class="line">			$centd[<span class="string">'disk_entries'</span>] = $data[<span class="string">'disk_entries'</span>];</div><div class="line">			$centd[<span class="string">'offset'</span>] = $data[<span class="string">'offset'</span>];$centd[<span class="string">'disk_start'</span>] = $data[<span class="string">'disk_start'</span>];</div><div class="line">			$centd[<span class="string">'size'</span>] = $data[<span class="string">'size'</span>];  $centd[<span class="string">'disk'</span>] = $data[<span class="string">'disk'</span>];</div><div class="line">			<span class="keyword">return</span> $centd;</div><div class="line">		  &#125;</div><div class="line"></div><div class="line">		 <span class="function"><span class="keyword">function</span> <span class="title">ExtractFile</span><span class="params">($header,$to,$zip)</span></span>&#123;</div><div class="line">			$header = <span class="keyword">$this</span>-&gt;readfileheader($zip);</div><div class="line"></div><div class="line">			<span class="keyword">if</span>(substr($to,<span class="number">-1</span>)!=<span class="string">"/"</span>) $to.=<span class="string">"/"</span>;</div><div class="line">			<span class="keyword">if</span>($to==<span class="string">'./'</span>) $to = <span class="string">''</span>;	</div><div class="line">			$pth = explode(<span class="string">"/"</span>,$to.$header[<span class="string">'filename'</span>]);</div><div class="line">			$mydir = <span class="string">''</span>;</div><div class="line">			<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($pth)<span class="number">-1</span>;$i++)&#123;</div><div class="line">				<span class="keyword">if</span>(!$pth[$i]) <span class="keyword">continue</span>;</div><div class="line">				$mydir .= $pth[$i].<span class="string">"/"</span>;</div><div class="line">				<span class="keyword">if</span>((!is_dir($mydir) &amp;&amp; @mkdir($mydir,<span class="number">0777</span>)) || (($mydir==$to.$header[<span class="string">'filename'</span>] || ($mydir==$to &amp;&amp; <span class="keyword">$this</span>-&gt;total_folders==<span class="number">0</span>)) &amp;&amp; is_dir($mydir)) )&#123;</div><div class="line">					@chmod($mydir,<span class="number">0777</span>);</div><div class="line">					<span class="keyword">$this</span>-&gt;total_folders ++;</div><div class="line">					<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;&lt;input name='dfile[]' type='checkbox' value='$mydir' checked&gt; &lt;a href='$mydir' target='_blank'&gt;目录: $mydir&lt;/a&gt;</span></div><div class="line">		";</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="keyword">if</span>(strrchr($header[<span class="string">'filename'</span>],<span class="string">'/'</span>)==<span class="string">'/'</span>) <span class="keyword">return</span>;	</div><div class="line"></div><div class="line">			<span class="keyword">if</span> (!($header[<span class="string">'external'</span>]==<span class="number">0x41FF0010</span>)&amp;&amp;!($header[<span class="string">'external'</span>]==<span class="number">16</span>))&#123;</div><div class="line">				<span class="keyword">if</span> ($header[<span class="string">'compression'</span>]==<span class="number">0</span>)&#123;</div><div class="line">					$fp = @fopen($to.$header[<span class="string">'filename'</span>], <span class="string">'wb'</span>);</div><div class="line">					<span class="keyword">if</span>(!$fp) <span class="keyword">return</span>(<span class="number">-1</span>);</div><div class="line">					$size = $header[<span class="string">'compressed_size'</span>];</div><div class="line"></div><div class="line">					<span class="keyword">while</span> ($size != <span class="number">0</span>)&#123;</div><div class="line">						$read_size = ($size &lt; <span class="number">2048</span> ? $size : <span class="number">2048</span>);</div><div class="line">						$buffer = fread($zip, $read_size);</div><div class="line">						$binary_data = pack(<span class="string">'a'</span>.$read_size, $buffer);</div><div class="line">						@fwrite($fp, $binary_data, $read_size);</div><div class="line">						$size -= $read_size;</div><div class="line">					&#125;</div><div class="line">					fclose($fp);</div><div class="line">					touch($to.$header[<span class="string">'filename'</span>], $header[<span class="string">'mtime'</span>]);</div><div class="line">				&#125;<span class="keyword">else</span>&#123;</div><div class="line">					$fp = @fopen($to.$header[<span class="string">'filename'</span>].<span class="string">'.gz'</span>,<span class="string">'wb'</span>);</div><div class="line">					<span class="keyword">if</span>(!$fp) <span class="keyword">return</span>(<span class="number">-1</span>);</div><div class="line">					$binary_data = pack(<span class="string">'va1a1Va1a1'</span>, <span class="number">0x8b1f</span>, Chr($header[<span class="string">'compression'</span>]),</div><div class="line">					Chr(<span class="number">0x00</span>), time(), Chr(<span class="number">0x00</span>), Chr(<span class="number">3</span>));</div><div class="line"></div><div class="line">					fwrite($fp, $binary_data, <span class="number">10</span>);</div><div class="line">					$size = $header[<span class="string">'compressed_size'</span>];</div><div class="line"></div><div class="line">					<span class="keyword">while</span> ($size != <span class="number">0</span>)&#123;</div><div class="line">						$read_size = ($size &lt; <span class="number">1024</span> ? $size : <span class="number">1024</span>);</div><div class="line">						$buffer = fread($zip, $read_size);</div><div class="line">						$binary_data = pack(<span class="string">'a'</span>.$read_size, $buffer);</div><div class="line">						@fwrite($fp, $binary_data, $read_size);</div><div class="line">						$size -= $read_size;</div><div class="line">					&#125;</div><div class="line"></div><div class="line">					$binary_data = pack(<span class="string">'VV'</span>, $header[<span class="string">'crc'</span>], $header[<span class="string">'size'</span>]);</div><div class="line">					fwrite($fp, $binary_data,<span class="number">8</span>); fclose($fp);</div><div class="line"></div><div class="line">					$gzp = @gzopen($to.$header[<span class="string">'filename'</span>].<span class="string">'.gz'</span>,<span class="string">'rb'</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Cette archive est compress閑"</span>);</div><div class="line">					<span class="keyword">if</span>(!$gzp) <span class="keyword">return</span>(<span class="number">-2</span>);</div><div class="line">					$fp = @fopen($to.$header[<span class="string">'filename'</span>],<span class="string">'wb'</span>);</div><div class="line">					<span class="keyword">if</span>(!$fp) <span class="keyword">return</span>(<span class="number">-1</span>);</div><div class="line">					$size = $header[<span class="string">'size'</span>];</div><div class="line"></div><div class="line">					<span class="keyword">while</span> ($size != <span class="number">0</span>)&#123;</div><div class="line">						$read_size = ($size &lt; <span class="number">2048</span> ? $size : <span class="number">2048</span>);</div><div class="line">						$buffer = gzread($gzp, $read_size);</div><div class="line">						$binary_data = pack(<span class="string">'a'</span>.$read_size, $buffer);</div><div class="line">						@fwrite($fp, $binary_data, $read_size);</div><div class="line">						$size -= $read_size;</div><div class="line">					&#125;</div><div class="line">					fclose($fp); gzclose($gzp);</div><div class="line"></div><div class="line">					touch($to.$header[<span class="string">'filename'</span>], $header[<span class="string">'mtime'</span>]);</div><div class="line">					@unlink($to.$header[<span class="string">'filename'</span>].<span class="string">'.gz'</span>);</div><div class="line"></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="keyword">$this</span>-&gt;total_files ++;</div><div class="line">			<span class="keyword">echo</span> <span class="string">"&lt;br /&gt;&lt;input name='dfile[]' type='checkbox' value='$to$header[filename]' checked&gt; &lt;a href='$to$header[filename]' target='_blank'&gt;文件: $to$header[filename]&lt;/a&gt;</span></div><div class="line">		";</div><div class="line"></div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		 &#125;</div><div class="line"></div><div class="line">		<span class="comment">// end class</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">			set_time_limit(<span class="number">0</span>);</div><div class="line"></div><div class="line">			<span class="keyword">if</span> ($_POST[<span class="string">'password'</span>] != $password) <span class="keyword">die</span>(<span class="string">"输入的密码不正确，请重新输入。"</span>);</div><div class="line">			<span class="keyword">if</span>(!$_POST[<span class="string">"todir"</span>]) $_POST[<span class="string">"todir"</span>] = <span class="string">"."</span>;</div><div class="line">			$z = <span class="keyword">new</span> Zip;</div><div class="line">			$have_zip_file = <span class="number">0</span>;</div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">start_unzip</span><span class="params">($tmp_name,$new_name,$checked)</span></span>&#123;</div><div class="line">				<span class="keyword">global</span> $_POST,$z,$have_zip_file;</div><div class="line">				$upfile = <span class="keyword">array</span>(<span class="string">"tmp_name"</span>=&gt;$tmp_name,<span class="string">"name"</span>=&gt;$new_name);</div><div class="line">				<span class="keyword">if</span>(is_file($upfile[tmp_name]))&#123;</div><div class="line">					$have_zip_file = <span class="number">1</span>;</div><div class="line">					<span class="keyword">echo</span> <span class="string">"</span></div><div class="line">		正在解压: &lt;br /&gt;&lt;input name='dfile[]' type='checkbox' value='$upfile[name]' ".($checked?<span class="string">"checked"</span>:<span class="string">""</span>).<span class="string">"&gt; $upfile[name]</span></div><div class="line"></div><div class="line">		";</div><div class="line">					<span class="keyword">if</span>(preg_match(<span class="string">'/\.zip$/mis'</span>,$upfile[name]))&#123;</div><div class="line">						$result=$z-&gt;Extract($upfile[tmp_name],$_POST[<span class="string">"todir"</span>]);</div><div class="line">						<span class="keyword">if</span>($result==<span class="number">-1</span>)&#123;</div><div class="line">							<span class="keyword">echo</span> <span class="string">"</span></div><div class="line">		文件 $upfile[name] 错误.</div><div class="line">		";</div><div class="line">						&#125;</div><div class="line">						<span class="keyword">echo</span> <span class="string">"</span></div><div class="line">		&lt;br /&gt;完成,共建立 $z-&gt;total_folders 个目录,$z-&gt;total_files 个文件.</div><div class="line"></div><div class="line">		";</div><div class="line">					&#125;<span class="keyword">else</span>&#123;</div><div class="line">						<span class="keyword">echo</span> <span class="string">"</span></div><div class="line">		$upfile[name] 不是 zip 文件.</div><div class="line"></div><div class="line">		";			</div><div class="line">					&#125;</div><div class="line">					<span class="keyword">if</span>(realpath($upfile[name])!=realpath($upfile[tmp_name]))&#123;</div><div class="line">						@unlink($upfile[name]);</div><div class="line">						rename($upfile[tmp_name],$upfile[name]);</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			clearstatcache();</div><div class="line"></div><div class="line">			start_unzip($_POST[<span class="string">"zipfile"</span>],$_POST[<span class="string">"zipfile"</span>],<span class="number">0</span>);</div><div class="line">			start_unzip($_FILES[<span class="string">"upfile"</span>][tmp_name],$_FILES[<span class="string">"upfile"</span>][name],<span class="number">1</span>);</div><div class="line"></div><div class="line">			<span class="keyword">if</span>(!$have_zip_file)&#123;</div><div class="line">				<span class="keyword">echo</span> <span class="string">"</span></div><div class="line">		请选择或上传文件.</div><div class="line">		";</div><div class="line">			&#125;</div><div class="line">		<span class="meta">?&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"&lt;?=$_POST['password'];?&gt;"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"myaction"</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"myaction"</span> <span class="attr">value</span>=<span class="string">"dodelete"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"按钮"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"返回"</span> <span class="attr">onClick</span>=<span class="string">"window.location='&lt;?=$_SERVER[PHP_SELF];?&gt;';"</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'button'</span> <span class="attr">value</span>=<span class="string">'反选'</span> <span class="attr">onclick</span>=<span class="string">'selrev();'</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">onclick</span>=<span class="string">'return confirm("删除选定文件?");'</span> <span class="attr">value</span>=<span class="string">'删除选定'</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">'javascript'</span>&gt;</span><span class="javascript"></span></div><div class="line">		<span class="function"><span class="keyword">function</span> <span class="title">selrev</span>(<span class="params"></span>) </span>&#123;</div><div class="line">			<span class="keyword">with</span>(<span class="built_in">document</span>.myform) &#123;</div><div class="line">				<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;elements.length;i++) &#123;</div><div class="line">					thiselm = elements[i];</div><div class="line">					<span class="keyword">if</span>(thiselm.name.match(<span class="regexp">/dfile\[]/</span>))	thiselm.checked = !thiselm.checked;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		alert(<span class="string">'完成.'</span>);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="php"><span class="meta">&lt;?</span></span></div><div class="line"></div><div class="line">		<span class="keyword">elseif</span>($_REQUEST[<span class="string">"myaction"</span>]==<span class="string">"dodelete"</span>):</div><div class="line">			set_time_limit(<span class="number">0</span>);</div><div class="line">			<span class="keyword">if</span> ($_POST[<span class="string">'password'</span>] != $password) <span class="keyword">die</span>(<span class="string">"输入的密码不正确，请重新输入。"</span>);</div><div class="line"></div><div class="line">			$dfile = $_POST[<span class="string">"dfile"</span>]; </div><div class="line">			<span class="keyword">echo</span> <span class="string">"正在删除文件...</span></div><div class="line"></div><div class="line">		";</div><div class="line">			<span class="keyword">if</span>(is_array($dfile))&#123;</div><div class="line">				<span class="keyword">for</span>($i=count($dfile)<span class="number">-1</span>;$i&gt;=<span class="number">0</span>;$i--)&#123;</div><div class="line">					<span class="keyword">if</span>(is_file($dfile[$i]))&#123;</div><div class="line">						<span class="keyword">if</span>(@unlink($dfile[$i]))&#123;</div><div class="line">							<span class="keyword">echo</span> <span class="string">"已删除文件: $dfile[$i]</span></div><div class="line">		";</div><div class="line">						&#125;<span class="keyword">else</span>&#123;</div><div class="line">							<span class="keyword">echo</span> <span class="string">"删除文件失败: $dfile[$i]</span></div><div class="line">		";</div><div class="line">						&#125;</div><div class="line">					&#125;<span class="keyword">else</span>&#123;</div><div class="line">						<span class="keyword">if</span>(@rmdir($dfile[$i]))&#123;</div><div class="line">							<span class="keyword">echo</span> <span class="string">"已删除目录: $dfile[$i]</span></div><div class="line">		";</div><div class="line">						&#125;<span class="keyword">else</span>&#123;</div><div class="line">							<span class="keyword">echo</span> <span class="string">"删除目录失败: $dfile[$i]</span></div><div class="line">		";</div><div class="line">						&#125;				</div><div class="line">					&#125;</div><div class="line"></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">echo</span> <span class="string">"</span></div><div class="line">		完成.</div><div class="line"></div><div class="line">		&lt;input type='button' value='返回' onclick=\"window.location='$_SERVER[PHP_SELF]';\"&gt;</div><div class="line"></div><div class="line">				 &lt;script language='javascript'&gt;('完成.');&lt;/script&gt;";</div><div class="line"></div><div class="line">		<span class="keyword">endif</span>;</div><div class="line"></div><div class="line">		<span class="meta">?&gt;</span></div><div class="line">		  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"footer"</span>&gt;</span></div><div class="line">    	<span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;copy; 2011 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.eincy.com"</span>&gt;</span>EinCy<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"eincy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/20/web-js-call/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/20/web-js-call/" itemprop="url">js call</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript"></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyObj</span><span class="params">()</span></span>&#123;  &#125;</div><div class="line"></div><div class="line">MyObj.prototype.myMethod = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">alert(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">new</span> MyObj().myMethod(<span class="number">1</span>);</div><div class="line"></div><div class="line">MyObj.prototype.myMethod(<span class="number">1</span>);</div><div class="line"></div><div class="line">MyObj.prototype.myMethod.call(<span class="number">1</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>运行结果是：</p>
<blockquote>
<p>[object Object]
[object Object]
1</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/20/web-js-dnd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/20/web-js-dnd/" itemprop="url">js拖动</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"&lt;a href="</span><span class="attr">http:</span>//<span class="attr">www.w3.org</span>/<span class="attr">1999</span>/<span class="attr">xhtml</span>"&gt;</span>http://www.w3.org/1999/xhtml<span class="tag">&lt;/<span class="name">a</span>&gt;</span>"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">runat</span>=<span class="string">"server"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">javascript</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line"><span class="keyword">var</span> intX;</div><div class="line"></div><div class="line"><span class="keyword">var</span> intY;</div><div class="line"></div><div class="line"><span class="keyword">var</span> blnDrag = <span class="literal">false</span>; <span class="comment">//鼠标是否已经按下</span></div><div class="line"></div><div class="line"><span class="comment">//鼠标按下</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MouseDown</span>(<span class="params">event,id</span>) </span>&#123;</div><div class="line"></div><div class="line"><span class="comment">//鼠标按下</span></div><div class="line"></div><div class="line">blnDrag = <span class="literal">true</span>;</div><div class="line"></div><div class="line">intX = event.clientX - GetDiv(id).style.pixelLeft;</div><div class="line"></div><div class="line">intY = event.clientY - GetDiv(id).style.pixelTop;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//鼠标拖动</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DragDiv</span>(<span class="params">event,id</span>) </span>&#123;</div><div class="line"></div><div class="line"><span class="comment">//判断鼠标是否已经按下</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (!blnDrag) &#123;</div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">GetDiv(id).style.pixelLeft = event.clientX - intX;</div><div class="line"></div><div class="line">GetDiv(id).style.pixelTop = event.clientY - intY;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//鼠标松开时</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mouseUp</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line"><span class="comment">//鼠标没有按下</span></div><div class="line"></div><div class="line">blnDrag = <span class="literal">false</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//得到DIV</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetDiv</span>(<span class="params">id</span>) </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"form1"</span> <span class="attr">runat</span>=<span class="string">"server"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span> <span class="attr">style</span>=<span class="string">"CURSOR: move; POSITION: absolute;  WIDTH: 140px; HEIGHT: 112px; background-color:Red"</span>     <span class="attr">onmousemove</span>=<span class="string">"DragDiv(event,this.id)"</span>     <span class="attr">onmousedown</span>=<span class="string">"MouseDown(event,this.id)"</span>     <span class="attr">onmouseup</span>=<span class="string">"mouseUp()"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/20/web-js-lightbox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/20/web-js-lightbox/" itemprop="url">全屏屏蔽、自动居中的lightBox</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">"Chomo"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"start"</span> <span class="attr">href</span>=<span class="string">"http://www.14px.com"</span> <span class="attr">title</span>=<span class="string">"Home"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>全屏屏蔽、自动居中的lightBox<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></div><div class="line">* &#123; margin:0; padding:0; &#125;</div><div class="line">html,body &#123; height:100%; overflow:hidden; font:12px/1.5 simsun;&#125;</div><div class="line">.myPage &#123; line-height:3; overflow:auto; width:100%; height:100%;&#125;</div><div class="line">.lightBox,</div><div class="line">.popupCover,</div><div class="line">.popupIframe,</div><div class="line">.popupComponent &#123; position:absolute; left:0; top:0; width:100%; height:100%;&#125;</div><div class="line">.popupComponent &#123; z-index:2; display:none;&#125;</div><div class="line">.popupIframe &#123; display:none; _display:block; _filter:alpha(opacity=0);&#125;</div><div class="line">.popupCover &#123; background:#000; opacity:0.7; *filter:alpha(opacity=70);&#125;</div><div class="line">.lightBox &#123; text-align:center; overflow:auto;&#125;</div><div class="line">.lightBoxContent &#123; display:inline-block; *display:inline; zoom:1; width:300px; padding:10px; background:#fff; border:5px solid #00b4ff; vertical-align:middle;&#125;</div><div class="line">.lightBoxMaxHeight &#123; display:inline-block; vertical-align:middle; height:100%; *height:99.5%; width:1px; overflow:hidden; margin-left:-1px;&#125;</div><div class="line">.lightBoxWrapper &#123; display:inline-block; *display:inline; zoom:1; text-align:left;&#125;</div><div class="line">.lightBoxClose &#123; color:#f00;&#125;</div><div class="line">.lightBoxSubmit &#123; margin-top:10px; padding-top:5px; border-top:1px solid #ccc;&#125;</div><div class="line">.lightBoxSubmit input &#123; font-size:12px; padding:0 10px; overflow:visible; margin:0 5px;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"popupComponent"</span> <span class="attr">id</span>=<span class="string">"lightBox"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">class</span>=<span class="string">"popupIframe"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"popupCover"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBox"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lightBoxMaxHeight"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBoxContent"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBoxWrapper"</span>&gt;</span></div><div class="line">                当提示小于一行时文字居中<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBoxSubmit"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"确定"</span> <span class="attr">onclick</span>=<span class="string">"hideLayer('lightBox')"</span> /&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"取消"</span> <span class="attr">onclick</span>=<span class="string">"hideLayer('lightBox')"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"popupComponent"</span> <span class="attr">id</span>=<span class="string">"lightBox2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">class</span>=<span class="string">"popupIframe"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"popupCover"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBox"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBoxContent"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBoxWrapper"</span>&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">                 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度 当内容已经超过了一屏的高度<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lightBoxSubmit"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"确定"</span> <span class="attr">onclick</span>=<span class="string">"hideLayer('lightBox2')"</span> /&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"取消"</span> <span class="attr">onclick</span>=<span class="string">"hideLayer('lightBox2')"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lightBoxMaxHeight"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"myPage"</span>&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center;"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"位于第一屏的按钮"</span> <span class="attr">onclick</span>=<span class="string">"showLayer('lightBox')"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>一个用于测试IE6中是否能覆盖住的select<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>又一个用于测试IE6中是否能覆盖住的select<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"text-align:center;"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"位于第二屏中的按钮"</span> <span class="attr">onclick</span>=<span class="string">"showLayer('lightBox')"</span> /&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"当内容已经超过了一屏的高度"</span> <span class="attr">onclick</span>=<span class="string">"showLayer('lightBox2')"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line">    假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span>假装很丰富的内容<span class="tag">&lt;<span class="name">br</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLayer</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(id).style.display = <span class="string">"block"</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hideLayer</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(id).style.display = <span class="string">"none"</span>;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/20/web-js-callback/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/20/web-js-callback/" itemprop="url">js回调函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>回调函数(callback)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="actionscript"></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(callback)</span>  </span>&#123;</div><div class="line"></div><div class="line">alert(<span class="string">"我是parent函数a！"</span>);</div><div class="line"></div><div class="line">alert(<span class="string">"调用回调函数"</span>);</div><div class="line"></div><div class="line">callback();</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">alert(<span class="string">"我是回调函数b"</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">alert(<span class="string">"我是回调函数c"</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span>  </span>&#123;</div><div class="line"></div><div class="line">a(b);</div><div class="line"></div><div class="line">a(c);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>学习js回调函数<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">test()</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>应该能看到调用了两个回调函数<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/05/java-xpath-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/05/java-xpath-api/" itemprop="url">Java 语言的 XPath API</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>如果要告诉别人买一加仑牛奶，您会怎么说？“请去买一加仑牛奶回来” 还是 “从前门出去，向左转，走三个街区向右转，再走半个街区向右转进入商店。走向四号通道，沿通道走五米向左，拿一瓶一加仑装的牛奶然后到收银台付款。再沿原路回家。” 简直太可笑了。只要在 “请去买一加仑牛奶回来” 的基础上稍加指示，多数成人都能自己买回牛奶来。
查询语言和计算机搜索与此类似。直接说 “找一个 Cryptonomicon 的副本” 要比编写搜索某个数据库的详细逻辑容易得多。由于搜索操作的逻辑非常相似，可以发明一种通用语言让您使用 “找到 Neal Stephenson 的所有著作” 这样的命令，然后编写对特定数据存储执行此类查询的引擎。</p>
<h1 id="xpath"><a class="header-anchor" href="#xpath"> </a>XPath</h1>
<p>在众多查询语言之中，结构化查询语言（SQL）是一种针对查询特定类型的关系库而设计和优化的语言。其他不那么常见的查询语言还有对象查询语言（OQL）和 XQuery。但本文的主题是 XPath，一种为查询 XML 文档而设计的查询语言。比如，下面这个简单的 XPath 查询可以在文档中找到作者为 Neal Stephenson 的所有图书的标题：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><div class="line"><span class="regexp">//</span>book[author=<span class="string">"Neal Stephenson"</span>]<span class="regexp">/title</span></div></pre></td></tr></table></figure>
<p>作为对照，查询同样信息的纯 DOM 搜索代码如下所示：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><div class="line">ArrayList result = <span class="keyword">new</span> ArrayList();</div><div class="line">NodeList books = doc.getElementsByTagName(<span class="string">"book"</span>);</div><div class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; books.getLength(); i++) &#123;</div><div class="line">    <span class="built_in">Element</span> book = (<span class="built_in">Element</span>) books.item(i);</div><div class="line">    NodeList authors = book.getElementsByTagName(<span class="string">"author"</span>);</div><div class="line">    boolean stephenson = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; authors.getLength(); j++) &#123;</div><div class="line">        <span class="built_in">Element</span> author = (<span class="built_in">Element</span>) authors.item(j);</div><div class="line">        NodeList children = author.getChildNodes();</div><div class="line">        <span class="built_in">StringBuffer</span> sb = <span class="keyword">new</span> <span class="built_in">StringBuffer</span>();</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> k = <span class="number">0</span>; k &lt; children.getLength(); k++) &#123;</div><div class="line">            Node child = children.item(k);</div><div class="line">            <span class="comment">// really should to do this recursively</span></div><div class="line">            <span class="keyword">if</span> (child.getNodeType() == Node.TEXT_NODE) &#123;</div><div class="line">                sb.append(child.getNodeValue());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (sb.toString().equals(<span class="string">"Neal Stephenson"</span>)) &#123;</div><div class="line">            stephenson = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (stephenson) &#123;</div><div class="line">        NodeList titles = book.getElementsByTagName(<span class="string">"title"</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; titles.getLength(); j++) &#123;</div><div class="line">            result.add(titles.item(j));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不论您是否相信，以上代码中的 DOM 显然不如简单的 XPath 表达式通用或者健壮。您愿意编写、调试和维护哪一个？我想答案很明显。
但是虽然有很强的表达能力，XPath 并不是 Java 语言，事实上 XPath 不是一种完整的编程语言。有很多东西用 XPath 表达不出来，甚至有些查询也无法表达。比方说，XPath 不能查找国际标准图书编码（ISBN）检验码不匹配的所有图书，或者找出境外帐户数据库显示欠帐的所有作者。幸运的是，可以把 XPath 结合到 Java 程序中，这样就能发挥两者的优势了：Java 做 Java 所擅长的，XPath 做 XPath 所擅长的。
直到最近，Java 程序执行 XPath 查询所需要的应用程序编程接口（API）还因形形色色的 XPath 引擎而各不相同。Xalan 有一种 API，Saxon 使用另一种，其他引擎则使用其他的 API。这意味着代码往往把您限制到一种产品上。理想情况下，最好能够试验具有不同性能特点的各种引擎，而不会带来不适当的麻烦或者重新编写代码。
于是，Java 5 推出了 javax.xml.xpath 包，提供一个引擎和对象模型独立的 XPath 库。这个包也可用于 Java 1.3 及以后的版本，但需要单独安装 Java API for XML Processing (JAXP) 1.3。Xalan 2.7 和 Saxon 8 以及其他产品包含了这个库的实现。</p>
<p>一个简单的例子
我将举例说明如何使用它。然后再讨论一些细节问题。假设要查询一个图书列表，寻找 Neal Stephenson 的著作。具体来说，这个图书列表的形式如 清单 2 所示：
清单 2. 包含图书信息的 XML 文档</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">inventory</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">book</span> <span class="attr">year</span>=<span class="string">"2000"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Snow Crash<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span>Neal Stephenson<span class="tag">&lt;/<span class="name">author</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">publisher</span>&gt;</span>Spectra<span class="tag">&lt;/<span class="name">publisher</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">isbn</span>&gt;</span>0553380958<span class="tag">&lt;/<span class="name">isbn</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">price</span>&gt;</span>14.95<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">book</span>&gt;</span></div><div class="line"> </div><div class="line">    <span class="tag">&lt;<span class="name">book</span> <span class="attr">year</span>=<span class="string">"2005"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Burning Tower<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span>Larry Niven<span class="tag">&lt;/<span class="name">author</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span>Jerry Pournelle<span class="tag">&lt;/<span class="name">author</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">publisher</span>&gt;</span>Pocket<span class="tag">&lt;/<span class="name">publisher</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">isbn</span>&gt;</span>0743416910<span class="tag">&lt;/<span class="name">isbn</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">price</span>&gt;</span>5.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">book</span>&gt;</span></div><div class="line"> </div><div class="line">    <span class="tag">&lt;<span class="name">book</span> <span class="attr">year</span>=<span class="string">"1995"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Zodiac<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span>Neal Stephenson<span class="tag">&lt;<span class="name">author</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">publisher</span>&gt;</span>Spectra<span class="tag">&lt;/<span class="name">publisher</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">isbn</span>&gt;</span>0553573862<span class="tag">&lt;/<span class="name">isbn</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">price</span>&gt;</span>7.50<span class="tag">&lt;/<span class="name">price</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">book</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- more books... --&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;/<span class="name">inventory</span>&gt;</span></div></pre></td></tr></table></figure>
<p>查找所有图书的 XPath 查询非常简单：//book[author=“Neal Stephenson”]。为了找出这些图书的标题，只要增加一步，表达式就变成了 //book[author=“Neal Stephenson”]/title。最后，真正需要的是 title 元素的文本节点孩子。这就要求再增加一步，完整的表达式就是 //book[author=“Neal Stephenson”]/title/text()。
现在我提供一个简单的程序，它从 Java 语言中执行这个查询，然后把找到的所有图书的标题打印出来。首先，需要将文档加载到一个 DOM Document 对象中。为了简化起见，假设该文档在当前工作目录的 books.xml 文件中。下面的简单代码片段解析文档并建立对应的 Document 对象：
清单 3. 用 JAXP 解析文档</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><div class="line">DocumentBuilderFactory <span class="keyword">factory</span> = DocumentBuilderFactory.newInstance();</div><div class="line">        <span class="keyword">factory</span>.setNamespaceAware(<span class="keyword">true</span>); <span class="comment">// never forget this!</span></div><div class="line">        DocumentBuilder builder = <span class="keyword">factory</span>.newDocumentBuilder();</div><div class="line">        Document doc = builder.parse(<span class="string">"books.xml"</span>);</div></pre></td></tr></table></figure>
<p>到目前为止，这仅仅是标准的 JAXP 和 DOM，没有什么新鲜的。
接下来创建 XPathFactory：
XPathFactory factory = XPathFactory.newInstance();
然后使用这个工厂创建 XPath 对象：
XPath xpath = factory.newXPath();
XPath 对象编译 XPath 表达式：
PathExpression expr = xpath.compile(&quot;//book[author=‘Neal Stephenson’]/title/text()&quot;);
直接求值
如果 XPath 表达式只使用一次，可以跳过编译步骤直接对 XPath 对象调用 evaluate() 方法。但是，如果同一个表达式要重复使用多次，编译可能更快一些。
最后，计算 XPath 表达式得到结果。表达式是针对特定的上下文节点计算的，在这个例子中是整个文档。还必须指定返回类型。这里要求返回一个节点集：
Object result = expr.evaluate(doc, XPathConstants.NODESET);
可以将结果强制转化成 DOM NodeList，然后遍历列表得到所有的标题：
NodeList nodes = (NodeList) result;
for (int i = 0; i &lt; nodes.getLength(); i++) {
System.out.println(nodes.item(i).getNodeValue());
}
清单 4 把上述片段组合到了一个程序中。还要注意，这些方法可能抛出一些检查异常，这些异常必须在 throws 子句中声明，但是我在上面把它们掩盖起来了：
清单 4. 用固定的 XPath 表达式查询 XML 文档的完整程序
import java.io.IOException;
import org.w3c.dom.<em>;
import org.xml.sax.SAXException;
import javax.xml.parsers.</em>;
import javax.xml.xpath.*;</p>
<p>public class XPathExample {</p>
<p>public static void main(String[] args)
throws ParserConfigurationException, SAXException,
IOException, XPathExpressionException {</p>
<pre><code>DocumentBuilderFactory domFactory = DocumentBuilderFactory.newInstance();
domFactory.setNamespaceAware(true); // never forget this!
DocumentBuilder builder = domFactory.newDocumentBuilder();
Document doc = builder.parse(&quot;books.xml&quot;);

XPathFactory factory = XPathFactory.newInstance();
XPath xpath = factory.newXPath();
XPathExpression expr 
 = xpath.compile(&quot;//book[author='Neal Stephenson']/title/text()&quot;);

Object result = expr.evaluate(doc, XPathConstants.NODESET);
NodeList nodes = (NodeList) result;
for (int i = 0; i &lt; nodes.getLength(); i++) {
    System.out.println(nodes.item(i).getNodeValue()); 
}
</code></pre>
<p>}</p>
<p>}
XPath 数据模型
每当混合使用诸如 XPath 和 Java 这样两种不同的语言时，必定会有某些将两者粘合在一起的明显接缝。并非一切都很合拍。XPath 和 Java 语言没有同样的类型系统。XPath 1.0 只有四种基本数据类型：
node-set
number
boolean
string
当然，Java 语言有更多的数据类型，包括用户定义的对象类型。
多数 XPath 表达式，特别是位置路径，都返回节点集。但是还有其他可能。比如，XPath 表达式 count(//book) 返回文档中的图书数量。XPath 表达式 count(//book[@author=“Neal Stephenson”]) &gt; 10 返回一个布尔值：如果文档中 Neal Stephenson 的著作超过 10 本则返回 true，否则返回 false。
evaluate() 方法被声明为返回 Object。实际返回什么依赖于 XPath 表达式的结果以及要求的类型。一般来说，XPath 的
number 映射为 java.lang.Double
string 映射为 java.lang.String
boolean 映射为 java.lang.Boolean
node-set 映射为 org.w3c.dom.NodeList
XPath 2
前面一直假设您使用的是 XPath 1.0。XPath 2 大大扩展和修改了类型系统。Java XPath API 支持 XPath 2 所需的主要修改是为返回 XPath 2 新数据类型增加常量。
在 Java 中计算 XPath 表达式时，第二个参数指定需要的返回类型。有五种可能，都在 javax.xml.xpath.XPathConstants 类中命名了常量：
XPathConstants.NODESET
XPathConstants.BOOLEAN
XPathConstants.NUMBER
XPathConstants.STRING
XPathConstants.NODE
最后一个 XPathConstants.NODE 实际上没有匹配的 XPath 类型。只有知道 XPath 表达式只返回一个节点或者只需要一个节点时才使用它。如果 XPath 表达式返回了多个节点并且指定了 XPathConstants.NODE，则 evaluate() 按照文档顺序返回第一个节点。如果 XPath 表达式选择了一个空集并指定了 XPathConstants.NODE，则 evaluate() 返回 null。
如果不能完成要求的转换，evaluate() 将抛出 XPathException。
回页首
名称空间上下文
若 XML 文档中的元素在名称空间中，查询该文档的 XPath 表达式必须使用相同的名称空间。XPath 表达式不一定要使用相同的前缀，只需要名称空间 URI 相同即可。事实上，如果 XML 文档使用默认名称空间，那么尽管目标文档没有使用前缀，XPath 表达式也必须使用前缀。
但是，Java 程序不是 XML 文档，因此不能用一般的名称空间解析。必须提供一个对象将前缀映射到名称空间 URI。该对象是 javax.xml.namespace.NamespaceContext 接口的实例。比如，假设图书文档放在 <a href="http://www.example.com/books" target="_blank" rel="external">http://www.example.com/books</a> 名称空间中，如 清单 5 所示：
清单 5. 使用默认名称空间的 XML 文档
<inventory xmlns="http://www.example.com/books">
<book year="2000">
<title>Snow Crash</title>
<author>Neal Stephenson</author>
<publisher>Spectra</publisher>
<isbn>0553380958</isbn>
<price>14.95<price>
</price></price></book></inventory></p>
<pre><code>&lt;!-- more books... --&gt;
</code></pre>
<inventory>
查找 Neal Stephenson 全部著作标题的 XPath 表达式就要改为 //pre:book[pre:author="Neal Stephenson"]/pre:title/text()。但是，必须将前缀 pre 映射到 URI http://www.example.com/books。NamespaceContext 接口在 Java 软件开发工具箱（JDK）或 JAXP 中没有默认实现似乎有点笨，但确实如此。不过，自己实现也不难。清单 6 对一个名称空间给出了简单的实现。还需要映射 xml 前缀。
清单 6. 绑定一个名称空间和默认名称空间的简单上下文
import java.util.Iterator;
import javax.xml.*;
import javax.xml.namespace.NamespaceContext;
<p>public class PersonalNamespaceContext implements NamespaceContext {</p>
<pre><code>public String getNamespaceURI(String prefix) {
    if (prefix == null) throw new NullPointerException(&quot;Null prefix&quot;);
    else if (&quot;pre&quot;.equals(prefix)) return &quot;http://www.example.org/books&quot;;
    else if (&quot;xml&quot;.equals(prefix)) return XMLConstants.XML_NS_URI;
    return XMLConstants.NULL_NS_URI;
}

// This method isn't necessary for XPath processing.
public String getPrefix(String uri) {
    throw new UnsupportedOperationException();
}

// This method isn't necessary for XPath processing either.
public Iterator getPrefixes(String uri) {
    throw new UnsupportedOperationException();
}
</code></pre>
<p>}
使用映射存储绑定和增加 setter 方法实现名称空间上下文的重用也不难。
创建 NamespaceContext 对象后，在编译表达式之前将其安装到 XPath 对象上。以后就可以像以前一样是用这些前缀查询了。比如：
清单 7. 使用名称空间的 XPath 查询
XPathFactory factory = XPathFactory.newInstance();
XPath xpath = factory.newXPath();
xpath.setNamespaceContext(new PersonalNamespaceContext());
XPathExpression expr
= xpath.compile(&quot;//pre:book[pre:author=‘Neal Stephenson’]/pre:title/text()&quot;);</p>
<p>Object result = expr.evaluate(doc, XPathConstants.NODESET);
NodeList nodes = (NodeList) result;
for (int i = 0; i &lt; nodes.getLength(); i++) {
System.out.println(nodes.item(i).getNodeValue());
}
回页首
函数求解器
有时候，在 Java 语言中定义用于 XPath 表达式的扩展函数很有用。这些函数可以执行用纯 XPath 很难或者无法执行的任务。不过必须是真正的函数，而不是随意的方法。就是说不能有副作用。（XPath 函数可以按照任意的顺序求值任意多次。）
通过 Java XPath API 访问的扩展函数必须实现 javax.xml.xpath.XPathFunction 接口。这个接口只声明了一个方法 evaluate：
public Object evaluate(List args) throws XPathFunctionException
该方法必须返回 Java 语言能够转换到 XPath 的五种类型之一：
String
Double
Boolean
Nodelist
Node
比如，清单 8 显示了一个扩展函数，它检查 ISBN 的校验和并返回 Boolean。这个校验和的基本规则是前九位数的每一位乘上它的位置（即第一位数乘上 1，第二位数乘上 2，依次类推）。将这些数加起来然后取除以 11 的余数。如果余数是 10，那么最后一位数就是 X。
清单 8. 检查 ISBN 的 XPath 扩展函数
import java.util.List;
import javax.xml.xpath.<em>;
import org.w3c.dom.</em>;</p>
<p>public class ISBNValidator implements XPathFunction {</p>
<p>// This class could easily be implemented as a Singleton.</p>
<p>public Object evaluate(List args) throws XPathFunctionException {</p>
<pre><code>if (args.size() != 1) {
  throw new XPathFunctionException(&quot;Wrong number of arguments to valid-isbn()&quot;);
}

String isbn;
Object o = args.get(0);

// perform conversions
if (o instanceof String) isbn = (String) args.get(0);
else if (o instanceof Boolean) isbn = o.toString();
else if (o instanceof Double) isbn = o.toString();
else if (o instanceof NodeList) {
    NodeList list = (NodeList) o;
    Node node = list.item(0);
    // getTextContent is available in Java 5 and DOM 3.
    // In Java 1.4 and DOM 2, you'd need to recursively 
    // accumulate the content.
    isbn= node.getTextContent();
}
else {
    throw new XPathFunctionException(&quot;Could not convert argument type&quot;);
}

char[] data = isbn.toCharArray();
if (data.length != 10) return Boolean.FALSE;
int checksum = 0;
for (int i = 0; i &lt; 9; i++) {
    checksum += (i+1) * (data[i]-'0');
}
int checkdigit = checksum % 11;

if (checkdigit + '0' == data[9] || (data[9] == 'X' &amp;&amp; checkdigit == 10)) {
    return Boolean.TRUE;
}
return Boolean.FALSE;
</code></pre>
<p>}</p>
<p>}
下一步让这个扩展函数能够在 Java 程序中使用。为此，需要在编译表达式之前向 XPath 对象安装 javax.xml.xpath.XPathFunctionResolver。函数求解器将函数的 XPath 名称和名称空间 URI 映射到实现该函数的 Java 类。清单 9 是一个简单的函数求解器，将扩展函数 valid-isbn 和名称空间 <a href="http://www.example.org/books" target="_blank" rel="external">http://www.example.org/books</a> 映射到 清单 8 中的类。比如，XPath 表达式 //book[not(pre:valid-isbn(isbn))] 可以找到 ISBN 校验和不匹配的所有图书。
清单 9. 识别 valid-isbn 扩展函数的上下文
iimport javax.xml.namespace.QName;
import javax.xml.xpath.*;</p>
<p>public class ISBNFunctionContext implements XPathFunctionResolver {</p>
<p>private static final QName name
= new QName(“<a href="http://www.example.org/books" target="_blank" rel="external">http://www.example.org/books</a>”, “valid-isbn”);</p>
<p>public XPathFunction resolveFunction(QName name, int arity) {
if (name.equals(<a href="http://ISBNFunctionContext.name" target="_blank" rel="external">ISBNFunctionContext.name</a>) &amp;&amp; arity == 1) {
return new ISBNValidator();
}
return null;
}</p>
<p>}
由于扩展函数必须有名称空间，所以计算包含扩展函数的表达式时必须使用 NamespaceResolver，即便查询的文档没有使用任何名称空间。由于 XPathFunctionResolver、XPathFunction 和 NamespaceResolver 都是接口，如果方便的话可以将它们放在所有的类中。
回页首
结束语
用 SQL 和 XPath 这样的声明性语言编写查询，要比使用 Java 和 C 这样的命令式语言容易得多。但是，用 Java 和 C 这样的图灵完整语言编写复杂的逻辑，又比 SQL 和 XPath 这样的声明性语言容易得多。所幸的是，通过使用 Java Database Connectivity (JDBC) 和 javax.xml.xpath 之类的 API 可以将两者结合起来。随着世界上越来越多的数据转向 XML，javax.xml.xpath 将与 java.sql 一样变得越来越重要。</p>
</inventory>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/05/linux-wget-guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/05/linux-wget-guide/" itemprop="url">wget用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>wget是在Linux下开发的开放源代码的软件，作者是Hrvoje Niksic，后来被移植到包括Windows在内的各个平台上。
它有以下功能和特点：</p>
<ol>
<li>支持断点下传功能；这一点，也是网络蚂蚁和FlashGet当年最大的卖点，现在，Wget也可以使用此功能，那些网络不是太好的用户可以放心了；</li>
<li>同时支持FTP和HTTP下载方式；尽管现在大部分软件可以使用HTTP方式下载，但是，有些时候，仍然需要使用FTP方式下载软件；</li>
<li>支持代理服务器；对安全强度很高的系统而言，一般不会将自己的系统直接暴露在互联网上，所以，支持代理是下载软件必须有的功能；</li>
<li>设置方便简单；可能，习惯图形界面的用户已经不是太习惯命令行了，但是，命令行在设置上其实有更多的优点，最少，鼠标可以少点很多次，也不要担心是否错点鼠标；</li>
<li>程序小，完全免费；程序小可以考虑不计，因为现在的硬盘实在太大了；完全免费就不得不考虑了，即使网络上有很多所谓的免费软件，但是，这些软件的广告却不是我们喜欢的； wget虽然功能强大，但是使用起来还是比较简单的，基本的语法是：wget [参数列表] URL。</li>
</ol>
<p>下面就结合具体的例子来说明一下wget的用法。</p>
<ol>
<li>下载整个http或者ftp站点。 <code>wget http://place.your.url/here</code> 这个命令可以将<code>http://place.your.url/here</code> 首页下载下来。使用-x会强制建立服务器上一模一样的目录，如果使用-nd参数，那么服务器上下载的所有内容都会加到本地当前目录。
<code>wget -r http://place.your.url/here</code> 这 个命令会按照递归的方法，下载服务器上所有的目录和文件，实质就是下载整个网站。这个命令一定要小心使用，因为在下载的时候，被下载网站指向的所有地址同 样会被下载，因此，如果这个网站引用了其他网站，那么被引用的网站也会被下载下来！基于这个原因，这个参数不常用。可以用<code>-l number</code>参数来指定下载的层次。例如只下载两层，那么使用<code>-l 2</code>。
要是您想制作镜像站点，那么可以使用－m参数，例如：<code>wget -m http://place.your.url/here</code>这时wget会自动判断合适的参数来制作镜像站点。此时，wget会登录到服务器上，读入robots.txt并按robots.txt的规定来执行。</li>
<li>断点续传。 当文件特别大或者网络特别慢的时候，往往一个文件还没有下载完，连接就已经被切断，此时就需要断点续传。wget的断点续传是自动的，只需要使用<code>-c</code>参数，例如： <code>wget -c http://the.url.of/incomplete/file</code>使用断点续传要求服务器支持断点续传。<code>-t</code>参数表示重试次数，例如需要重试100次，那么就写<code>-t 100</code>，如果设成<code>-t 0</code>，那么表示无穷次重试，直到连接成功。<code>-T</code>参数表示超时等待时间，例如<code>-T 120</code>，表示等待120秒连接不上就算超时。</li>
<li>批量下载。 如果有多个文件需要下载，那么可以生成一个文件，把每个文件的URL写一行，例如生成文件download.txt，然后用命令：<code>wget -i download.txt</code>这样就会把download.txt里面列出的每个URL都下载下来。（如果列的是文件就下载文件，如果列的是网站，那么下载首页）</li>
<li>选择性的下载。 可以指定让wget只下载一类文件，或者不下载什么文件。例如： <code>wget -m –reject=gif http://target.web.site/subdirectory</code>表示下载<code>http://target.web.site/subdirectory</code>，但是忽略gif文件。<code>–accept=LIST</code> 可以接受的文件类型，<code>–reject=LIST</code>拒绝接受的文件类型。</li>
<li>密码和认证。 wget只能处理利用用户名/密码方式限制访问的网站，可以利用两个参数： –http-user=USER设置HTTP用户 <code>–http-passwd=PASS</code>设置HTTP密码 对于需要证书做认证的网站，就只能利用其他下载工具了，例如curl。</li>
<li>利用代理服务器进行下载。 如果用户的网络需要经过代理服务器，那么可以让wget通过代理服务器进行文件的下载。此时需要在当前用户的目录下创建一个.wgetrc文件。文件中可以设置代理服务器： <code>http-proxy = 111.111.111.111:8080 ftp-proxy = 111.111.111.111:8080</code> 分别表示http的代理服务器和ftp的代理服务器。如果代理服务器需要密码则使用： <code>–proxy-user=USER</code>设置代理用户 <code>–proxy-passwd=PASS</code>设置代理密码 这两个参数。 使用参数<code>–proxy=on/off</code> 使用或者关闭代理。 wget还有很多有用的功能，需要用户去挖掘。</li>
</ol>
<p>附录：</p>
<blockquote>
<p>命令格式： wget [参数列表] [目标软件、网页的网址]
-V,–version 显示软件版本号然后退出；
-h,–help显示软件帮助信息；
-e,–execute=COMMAND 执行一个 “.wgetrc”命令
-o,–output-file=FILE 将软件输出信息保存到文件；
-a,–append-output=FILE将软件输出信息追加到文件；
-d,–debug显示输出信息；
-q,–quiet 不显示输出信息；
-i,–input-file=FILE 从文件中取得URL；
-t,–tries=NUMBER 是否下载次数（0表示无穷次）
-O –output-document=FILE下载文件保存为别的文件名
-nc, –no-clobber 不要覆盖已经存在的文件
-N,–timestamping只下载比本地新的文件
-T,–timeout=SECONDS 设置超时时间
-Y,–proxy=on/off 关闭代理
-nd,–no-directories 不建立目录
-x,–force-directories 强制建立目录
–http-user=USER设置HTTP用户
–http-passwd=PASS设置HTTP密码
–proxy-user=USER设置代理用户
–proxy-passwd=PASS设置代理密码
-r,–recursive 下载整个网站、目录（小心使用）
-l,–level=NUMBER 下载层次
-A,–accept=LIST 可以接受的文件类型
-R,–reject=LIST拒绝接受的文件类型
-D,–domains=LIST可以接受的域名
–exclude-domains=LIST拒绝的域名
-L,–relative 下载关联链接 –follow-ftp 只下载FTP链接
-H,–span-hosts 可以下载外面的主机
-I,–include-directories=LIST允许的目录
-X,–exclude-directories=LIST 拒绝的目录
中文文档名在平常的情况下会被编码， 但是在 –cut-dirs 时又是正常的，
wget -r -np -nH –cut-dirs=3 <a href="ftp://host/test/" target="_blank" rel="external">ftp://host/test/</a> 测试.txt
wget -r -np -nH -nd <a href="ftp://host/test/" target="_blank" rel="external">ftp://host/test/</a> %B4%FA%B8%D5.txt
wget “<a href="ftp://host/test/*%E2%80%9D" target="_blank" rel="external">ftp://host/test/*”</a> %B4%FA%B8%D5.txt
由 於不知名的原因，可能是为了避开特殊档名， wget 会自动将抓取档名的部分用 encode_string 处理过， 所以该 patch 就把被 encode_string 处理成 “%3A” 这种东西， 用 decode_string 还原成 “:”，并套用在目录与档案名称的部分，decode_string 是 wget 内建的函式。
wget -t0 -c -nH -x -np -b -m -P /home/sunny/NOD32view/  <a href="http://downloads1.kaspersky-labs.com/bases/" target="_blank" rel="external">http://downloads1.kaspersky-labs.com/bases/</a> -o wget.log</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://2le.me/2012/06/04/web-get-swf-object-in-firefox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bianle">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/bianle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bianle's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/04/web-get-swf-object-in-firefox/" itemprop="url">在Firefox中如何获取网页里的SWF对象</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><p>我们经常会碰到flash和网页中的js脚本交互的的情况，一般的flash中使用ExternalInterface就可以让as脚本和html容器中的js脚本互相调用。但由于不同浏览器对DOM解析不同，导致有时候无法获取网页中的SWF对象。
下面是网页中插入flash的代码，应该再熟悉不过了：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">classid</span>=<span class="string">"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"</span></span></div><div class="line"> <span class="attr">codebase</span>=<span class="string">"http://download.macromedia.com/pub/shockwave/cabs/</span></div><div class="line"> flash/swflash.cab#version=7,0,19,0" <span class="attr">name</span>=<span class="string">"flashrek"</span> <span class="attr">width</span>=<span class="string">"285"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">id</span>=<span class="string">"flashrek"</span>&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"movie"</span> <span class="attr">value</span>=<span class="string">"flashrek.swf"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"quality"</span> <span class="attr">value</span>=<span class="string">"high"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">"flashrek.swf"</span> <span class="attr">width</span>=<span class="string">"285"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">quality</span>=<span class="string">"high"</span></span></div><div class="line"> <span class="attr">pluginspage</span>=<span class="string">http://www.macromedia.com/go/getflashplayer</span> <span class="attr">type</span>=<span class="string">"application/x-shockwave-flash"</span>&gt;<span class="tag">&lt;/<span class="name">embed</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></div></pre></td></tr></table></figure>
<p>如果用document.getElementById方法来获取flash对象的话，IE中正常而firefox中却不行。这主要是firefox与IE解析DOM的差异导致的，下面给出一种解决方法，同时满足不同浏览器的需求：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSWF</span>(<span class="params">name</span>)</span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">var</span> e=<span class="built_in">document</span>.getElementById(name);</div><div class="line"></div><div class="line"><span class="keyword">return</span> (navigator.appName.indexOf(<span class="string">"Microsoft"</span>) != <span class="number">-1</span>)?e:e.</div><div class="line"> getElementsByTagName(<span class="string">"embed"</span>)[<span class="number">0</span>];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用方法：getSWF(“flashrek”)。其中的参数是插入时设置的flash的ID。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/26/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><span class="page-number current">27</span><a class="page-number" href="/page/28/">28</a><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/28/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars.githubusercontent.com/bianle"
               alt="bianle" />
          <p class="site-author-name" itemprop="name">bianle</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">282</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">65</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">178</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/bianle" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/bianlelpqi" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/i9erle" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://😇😈.ws" title="http://😇😈.ws" target="_blank">http://😇😈.ws</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://dzm.la" title="短怎么啦" target="_blank">短怎么啦</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.tunnel.ink" title="ngrok" target="_blank">ngrok</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://xingyetang.com" title="唐兴业的博客" target="_blank">唐兴业的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.panpan.lu" title="卢盼盼的博客" target="_blank">卢盼盼的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://yangjian.me" title="Alimon's Blog" target="_blank">Alimon's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://hexo.io" title="Hexo" target="_blank">Hexo</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://timyang.net" title="Tim's Blog" target="_blank">Tim's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://lifegoo.pluskid.org/wiki/index.html" title="星黎殿" target="_blank">星黎殿</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://phl.iteye.com" title="猫头哥（朴海林）" target="_blank">猫头哥（朴海林）</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://zhaxiancheng" title="zxc" target="_blank">zxc</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bianle</span>
</div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">本站访客数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">本站总访问量</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "c9597f1b39254c22ba2f3fb2160ff765",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === '') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->





  

  

  

  

  

</body>
</html>
